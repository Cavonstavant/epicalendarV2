<!DOCTYPE html>
<html>
<head>
    <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
</head>
<body>

<h1>EpiCalendar</h1>

<p>
    Epicalendar is a tool to synchronize Epitech's intranet calendar to any ICalendar compatible service.
    (Example: Google Calendar, Apple Calendar, Outlook Calendar)

    This version was developed using nodeJS and express, you can find the github page here:
    https://github.com/simonmeyerrr/epicalendarv2
</p>
<p>
    "Add a calendar from a URL" with your favorite calendar and use one of the following url:

    - https://epicalendarv2.omnirem.dev/:autologin/planning.ics :

    This allows you to see all the activities to which you are registered. Appointment slots such as Follow-Up and
    Review are taken into account and only your slot will be displayed. Compatible with educational accounts.

    - https://epicalendarv2.omnirem.dev/:autologin/projects.ics :

    This allows you to see all the projects you are registered for with their start and end dates.

    - https://epicalendarv2.omnirem.dev/:autologin/projects-end.ics :

    This displays the project rendering dates. You can set up alarms to warn you when a project is about to finish.


    You have to replace :autologin in the url by your autologin code that you can find on
    https://intra.epitech.eu/admin/autolog

    Your autologin code is not saved in any database or in server's logs. If you still don't trust the service, you can
    host it on your personal server.
</p>

<h2> Get the link </h2>

<form id="form">
    <label for="autologin">Autologin: </label>
    <input type="text" name="autologin" id="autologin" required/>

    <label for="info"> Information: </label>
    <select id="info" name="info">
        <option value="planning"> Planning</option>
        <option value="projects"> Projects</option>
        <option value="projects-end"> Projects End</option>
    </select>

    <input type="submit" value="Submit"/>
</form>

<br/>
<div>
    Url: <span id="final_url"></span>
</div>
<br/>
<div>
    Result: <span id="result"></span>
</div>
<script type='text/javascript'>
    var loading = false;
    $("#form").submit(function (event) {
        event.preventDefault();
        if (loading)
            return;
        document.getElementById("result").innerHTML = `Loading...`;
        document.getElementById("final_url").innerHTML = `https://epicalendarv2.omnirem.dev/${event.target[0].value}/${event.target[1].value}.ics`;
        fetch(`/${event.target[0].value}/${event.target[1].value}.ics`)
            .then((response) => {
                if (response.status !== 200) {
                    response.json().then(function (data) {
                        document.getElementById("result").innerHTML = data.error;
                        loading = false;
                    });
                } else {
                    response.text().then(function (data) {
                        document.getElementById("result").innerHTML = data;
                        loading = false;
                    });
                }

            })
            .catch(function (err) {
                document.getElementById("result").innerHTML = err;
            });
    });
</script>

</body>
</html>
